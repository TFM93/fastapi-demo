{"name": "test_register", "status": "broken", "statusDetails": {"message": "RuntimeError: Task <Task pending name='anyio.from_thread.BlockingPortal._call_func' coro=<BlockingPortal._call_func() running at /Users/mindera/Projects/tiago/python/fastapi-demo/venv/lib/python3.13/site-packages/anyio/from_thread.py:217> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/mindera/Projects/tiago/python/fastapi-demo/venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py:661]> got Future <Future pending cb=[BaseProtocol._on_waiter_completed()]> attached to a different loop", "trace": "def test_register():\n        response = client.post(\"/register/\", json={\"email\": \"\", \"tenant\": \"\"})\n        assert response.status_code == 422\n    \n        response = client.post(\n            \"/register/\", json={\"email\": \"tttt\", \"tenant\": \"123\"}\n        )\n        assert response.status_code == 422\n    \n        randomName = \"\".join(\n            random.choice(string.ascii_uppercase + string.digits)\n            for _ in range(10)\n        )\n    \n        response1 = client.post(\n            \"/register/\",\n            json={\"email\": f\"{randomName}@email.com\", \"tenant\": \"123\"},\n        )\n        assert response1.status_code == 200\n    \n>       response3 = client.post(\n            \"/register/\",\n            json={\"email\": f\"{randomName}@email.com\", \"tenant\": \"123\"},\n        )\n\ntest_main.py:29: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.13/site-packages/starlette/testclient.py:608: in post\n    return super().post(\nvenv/lib/python3.13/site-packages/httpx/_client.py:1157: in post\n    return self.request(\nvenv/lib/python3.13/site-packages/starlette/testclient.py:491: in request\n    return super().request(\nvenv/lib/python3.13/site-packages/httpx/_client.py:837: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.13/site-packages/httpx/_client.py:926: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.13/site-packages/httpx/_client.py:954: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.13/site-packages/httpx/_client.py:991: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.13/site-packages/httpx/_client.py:1027: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.13/site-packages/starlette/testclient.py:372: in handle_request\n    raise exc\nvenv/lib/python3.13/site-packages/starlette/testclient.py:369: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.13/site-packages/anyio/from_thread.py:277: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/opt/homebrew/Cellar/python@3.13/3.13.0_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/opt/homebrew/Cellar/python@3.13/3.13.0_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.13/site-packages/anyio/from_thread.py:217: in _call_func\n    retval = await retval\nvenv/lib/python3.13/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.13/site-packages/starlette/applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.13/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.13/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.13/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.13/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.13/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.13/site-packages/starlette/routing.py:758: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.13/site-packages/starlette/routing.py:778: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.13/site-packages/starlette/routing.py:299: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.13/site-packages/starlette/routing.py:79: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.13/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.13/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.13/site-packages/starlette/routing.py:74: in app\n    response = await func(request)\nvenv/lib/python3.13/site-packages/fastapi/routing.py:278: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.13/site-packages/fastapi/routing.py:191: in run_endpoint_function\n    return await dependant.call(**values)\nmain.py:30: in register_user\n    db_user = await api.get_user_by_email(db, user.email)\nsrc/api.py:14: in get_user_by_email\n    result = await db.execute(select(User).filter(User.email == email))\nvenv/lib/python3.13/site-packages/sqlalchemy/ext/asyncio/session.py:461: in execute\n    result = await greenlet_spawn(\nvenv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:201: in greenlet_spawn\n    result = context.throw(*sys.exc_info())\nvenv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2362: in execute\n    return self._execute_internal(\nvenv/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2247: in _execute_internal\n    result: Result[Any] = compile_state_cls.orm_execute_statement(\nvenv/lib/python3.13/site-packages/sqlalchemy/orm/context.py:305: in orm_execute_statement\n    result = conn.execute(\nvenv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1418: in execute\n    return meth(\nvenv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:515: in _execute_on_connection\n    return connection._execute_clauseelement(\nvenv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1640: in _execute_clauseelement\n    ret = self._execute_context(\nvenv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context\n    return self._exec_single_context(\nvenv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context\n    self._handle_dbapi_exception(\nvenv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2358: in _handle_dbapi_exception\n    raise exc_info[1].with_traceback(exc_info[2])\nvenv/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context\n    self.dialect.do_execute(\nvenv/lib/python3.13/site-packages/sqlalchemy/engine/default.py:941: in do_execute\n    cursor.execute(statement, parameters)\nvenv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:568: in execute\n    self._adapt_connection.await_(\nvenv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:132: in await_only\n    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501\nvenv/lib/python3.13/site-packages/sqlalchemy/util/_concurrency_py3k.py:196: in greenlet_spawn\n    value = await result\nvenv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:504: in _prepare_and_execute\n    await adapt_connection._start_transaction()\nvenv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:833: in _start_transaction\n    self._handle_exception(error)\nvenv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:782: in _handle_exception\n    raise error\nvenv/lib/python3.13/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py:831: in _start_transaction\n    await self._transaction.start()\nvenv/lib/python3.13/site-packages/asyncpg/transaction.py:146: in start\n    await self._connection.execute(query)\nvenv/lib/python3.13/site-packages/asyncpg/connection.py:349: in execute\n    result = await self._protocol.query(query, timeout)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\n>   ???\nE   RuntimeError: Task <Task pending name='anyio.from_thread.BlockingPortal._call_func' coro=<BlockingPortal._call_func() running at /Users/mindera/Projects/tiago/python/fastapi-demo/venv/lib/python3.13/site-packages/anyio/from_thread.py:217> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/mindera/Projects/tiago/python/fastapi-demo/venv/lib/python3.13/site-packages/anyio/_backends/_asyncio.py:661]> got Future <Future pending cb=[BaseProtocol._on_waiter_completed()]> attached to a different loop\n\nasyncpg/protocol/protocol.pyx:375: RuntimeError"}, "attachments": [{"name": "log", "source": "0fb9907b-9f20-49a8-9348-dad32d63528f-attachment.txt", "type": "text/plain"}, {"name": "stdout", "source": "312aa590-0ff0-4f78-9061-d9da8e8b3ce6-attachment.txt", "type": "text/plain"}], "start": 1729693845816, "stop": 1729693845894, "uuid": "b5e51be0-921e-4446-b6a3-ef78c0e3f26e", "historyId": "c92688e32cd06251a44ef0222f3b47c1", "testCaseId": "c92688e32cd06251a44ef0222f3b47c1", "fullName": "test_main#test_register", "labels": [{"name": "suite", "value": "test_main"}, {"name": "host", "value": "Galaxy-S9"}, {"name": "thread", "value": "91642-MainThread"}, {"name": "framework", "value": "pytest"}, {"name": "language", "value": "cpython3"}, {"name": "package", "value": "test_main"}]}